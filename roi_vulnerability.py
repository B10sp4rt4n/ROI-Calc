import matplotlib.pyplot as plt
import numpy as np

def calcular_y_graficar(inversion_inicial, años_cobertura, sueldo_mensual, num_pcs, nivel_automatizacion, num_actualizaciones_anuales):
    # Cálculos iniciales
    costo_hora_hombre = sueldo_mensual / 160  # USD/hora
    horas_por_actualizacion = 1  # Horas por actualización manual por PC

    # Esfuerzo ahorrado
    horas_ahorradas_por_pc_anuales = horas_por_actualizacion * num_actualizaciones_anuales * nivel_automatizacion
    ahorro_anual = horas_ahorradas_por_pc_anuales * num_pcs * costo_hora_hombre
    ahorro_mensual = ahorro_anual / 12

    # Beneficio neto y métricas clave
    beneficio_neto_anual = ahorro_anual
    payback_period = inversion_inicial / ahorro_mensual
    roi = (beneficio_neto_anual * años_cobertura / inversion_inicial) * 100

    # Datos para gráficas
    # Beneficio acumulado hasta el mes 48
    meses = range(1, 49)
    beneficio_acumulado = [ahorro_mensual * mes for mes in meses]

    # Inversión vs ROI
    niveles_inversion = np.linspace(10000, 50000, 100)  # Rango de inversión
    rois_inversion = [(beneficio_neto_anual * años_cobertura / inversion) * 100 for inversion in niveles_inversion]

    # Generar gráficas
    plt.figure(figsize=(14, 6))

    # Gráfica 1: Beneficio acumulado y Payback Period
    plt.subplot(1, 2, 1)
    plt.plot(meses, beneficio_acumulado, label="Beneficio Acumulado (USD)", linewidth=2)
    plt.axhline(inversion_inicial, color='red', linestyle='--', label=f"Inversión Inicial (${inversion_inicial})")
    if payback_period <= 48:
        plt.axvline(payback_period, color='green', linestyle='--', label=f"Payback Period ({payback_period:.1f} meses)")
    plt.title("Beneficio Acumulado y Payback Period", fontsize=14)
    plt.xlabel("Meses", fontsize=12)
    plt.ylabel("Beneficio Acumulado (USD)", fontsize=12)
    plt.grid(True, linestyle='--', alpha=0.6)
    plt.legend(fontsize=10)

    # Gráfica 2: Inversión vs ROI
    plt.subplot(1, 2, 2)
    plt.plot(niveles_inversion, rois_inversion, label="Inversión vs ROI", linewidth=2)
    plt.axvline(inversion_inicial, color='green', linestyle='--', label=f"Inversión del Ejercicio (${inversion_inicial})")
    plt.scatter([inversion_inicial], [roi], color='red', zorder=5, label=f"ROI del Ejercicio ({roi:.1f}%)")
    plt.title("Inversión vs ROI", fontsize=14)
    plt.xlabel("Nivel de Inversión (USD)", fontsize=12)
    plt.ylabel("ROI (%)", fontsize=12)
    plt.grid(True, linestyle='--', alpha=0.6)
    plt.legend(fontsize=10)

    plt.tight_layout()
    plt.show()

    # Resultados principales
    return {
        "Costo por Hora-Hombre (USD)": costo_hora_hombre,
        "Esfuerzo Ahorrado por PC Anual (horas)": horas_ahorradas_por_pc_anuales,
        "Ahorro Mensual Total (USD)": ahorro_mensual,
        "Beneficio Neto Anual (USD)": beneficio_neto_anual,
        "Payback Period (meses)": payback_period,
        "ROI (%)": roi
    }

